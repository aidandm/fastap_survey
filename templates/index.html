<!DOCTYPE html>
<html lang="en">
  
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content=
        "width=device-width, initial-scale=1.0">
    <title>
        CompanyName
    </title>
    <link rel="stylesheet" type="text/css" href="/static/index.css" />
</head>
<header>
    <div class="header">
        <p>InsightIQ</p>
        <ul class="header-items">
            <li><a class="open-button" onclick="openForm()">Login</a></li>
        </ul>
    </div>
    <div class="overlay" id="overlay"></div>
    <div class="form-popup" id="login-form">
        <form action="/login" method="post" class="form-container">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <h1>Login</h1>
        
            <label for="email"><b>Email</b></label>
            <input type="text" placeholder="Enter Email" name="username" required>
        
            <label for="psw"><b>Password</b></label>
            <input type="password" placeholder="Enter Password" name="password" required>
        
        
            <button type="submit" class="btn">Login</button>
            <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
        </form>  
        <form action="/usersignup" method="get">
            <p>Not a user? <button>Signup!</button></p>
        </form>      
        
    </div>
    <script>
        function openForm() {
        document.getElementById("myForm").style.display = "block";
        document.getElementById("overlay").style.display = "block";
        }

        function closeForm() {
        document.getElementById("myForm").style.display = "none";
        document.getElementById("overlay").style.display = "none";
        } 
    </script> 
</header>
<body>
    <h1>Find out more about you!</h1>
    <p>
         Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus. 
         Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies
         sed, dolor. Cras elementum ultrices diam. Maecenas ligula massa, varius 
         a, semper conguSe, euismod non, mi. Proin porttitor, orci nec nonummy 
         molestie, enim est eleifend mi, non fermentum diam nisl sit amet erat. 
         Duis semper. Duis arcu massa, scelerisque vitae, consequat in, pretium 
         a, enim. Pellentesque congue. Ut in risus volutpat libero pharetra tempor. 
         Cras vestibulum bibendum augue. Praesent egestas leo in pede. Praesent blandit
          odio eu enim. Pellentesque sed dui ut augue blandit sodales. Vestibulum ante 
          ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aliquam
           nibh.
    </p>
    <script>
        document.getElementById("login-form").addEventListener("submit", async (event) => {
          event.preventDefault(); // Prevent form from submitting
      
          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;
      
          try {
            const response = await fetch("/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/x-www-form-urlencoded",
              },
              body: `username=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`,
            });
      
            if (!response.ok) {
              throw new Error("Invalid credentials");
            }
      
            const data = await response.json();
            localStorage.setItem("accessToken", data.access_token);
      
            // Redirect to the protected page after successful login
            window.location.href = "/protected";
          } catch (error) {
            // Handle errors, e.g., show an error message to the user
            console.error("Login error:", error.message);
          }
        });
      </script>
</body>